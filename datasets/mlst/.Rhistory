duplicates
#duplicates
duplicates <- total_tbl %>% dplyr::select(organism.x, duplicates, total.x) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=duplicates/total.x, fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
ylim(0,0.3) +
theme(legend.position = "none") +
ylab("Proportion Duplicates") +
xlab("Organism")
duplicates
#duplicates
duplicates <- s %>% dplyr::select(organism.x, duplicates, total.x) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=duplicates/total.x, fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
ylim(0,0.3) +
theme(legend.position = "none") +
ylab("Proportion Duplicates") +
xlab("Organism")
duplicates
#bases above 15
abovefifteen<- total_tbl %>% dplyr::select(organism.y, `%_bases_above_15`) %>% drop_na() %>%
ggplot(aes(x = organism.y, y=as.numeric(`%_bases_above_15`), fill=organism.y)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Proportion Above 15X") +
xlab("Organism")
#pl mean_d_o_c
meandoc <- total_tbl %>% dplyr::select(organism.x, mean) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=mean, fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha = 0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Mean Depth-of-Coverage") +
xlab("Organism")
meandoc
#bases above 15
abovefifteen<- total_tbl %>% dplyr::select(organism.x, `%_bases_above_15`) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=as.numeric(`%_bases_above_15`), fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Proportion Above 15X") +
xlab("Organism")
abovefifteen
#duplicates
duplicates <- s %>% dplyr::select(organism.x, duplicates, total.x) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=duplicates/total.x, fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
ylim(0,0.3) +
theme(legend.position = "none") +
ylab("Proportion Duplicates") +
xlab("Organism")
duplicates
plot_grid(
duplicates, meandoc, abovefifteen, NULL,
labels = c("A", "B", "C"), ncol = 2
)
meandoc
#pl mean_d_o_c
meandoc <- total_tbl %>% dplyr::select(organism.x, mean) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=mean, fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha = 0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Mean Depth-of-Coverage") +
xlab("Organism")
#pl mean_d_o_c
meandoc <- s %>% dplyr::select(organism.x, mean) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=mean, fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha = 0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Mean Depth-of-Coverage") +
xlab("Organism")
meandoc
#bases above 15
abovefifteen<- s %>% dplyr::select(organism.x, `%_bases_above_15`) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=as.numeric(`%_bases_above_15`), fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Proportion Above 15X") +
xlab("Organism")
abovefifteen
#bases above 15
abovefifteen<- s %>% dplyr::select(organism.x, frac_genome_bases_over_15) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=as.numeric(`%_bases_above_15`), fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Proportion Above 15X") +
xlab("Organism")
abovefifteen
#bases above 15
abovefifteen<- s %>% dplyr::select(organism.x, frac_genome_bases_over_15) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=as.numeric(frac_genome_bases_over_15), fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Proportion Above 15X") +
xlab("Organism")
abovefifteen
View(covtable)
View(sum_tbl)
View(sum_tbl)
View(interval_tbl)
View(interval_tbl)
View(s)
View(total_tbl)
interval_tbl
#join interval to total cov tables
covtable = interval_tbl %>%
dplyr::select(sample_id, baits_covered_overfifteen ) %>%
left_join(sum_tbl %>%
dplyr::select(-organism, -filename)) %>%
rename(frac_genome_bases_over_15 = `%_bases_above_15`)
#join interval to total cov tables
covtable = interval_tbl %>%
dplyr::select(sample_id, baits_covered_overfifteen) %>%
left_join(sum_tbl %>%
dplyr::select(-organism, -filename)) %>%
rename(frac_genome_bases_over_15 = `%_bases_above_15`)
################
#let's take a look at our metadata
total_tbl= left_join(mappingdata, covtable, by = c('sample_id' = 'sample_id'))
#check everything is ok (e.g. we have the req uired number of samples for anthrac (93) and myco (56))
total_tbl %>%  group_by(organism) %>% count()
#join to sample metadata
s = left_join(metadata, total_tbl, by =c('sample_id' = 'sample_id'))
#wo
write_csv(s, '~/Projects/bactocap/metadata/all_metadata.csv')
#pl mean_d_o_c
meandoc <- s %>% dplyr::select(organism.x, mean) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=mean, fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha = 0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Mean Depth-of-Coverage") +
xlab("Organism")
meandoc
#genome bases above 15
baitsabovefifteen<- s %>% dplyr::select(organism.x, baits_covered_overfifteen) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=as.numeric(baits_covered_overfifteen), fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Proportion Baits Covered Above 15X") +
xlab("Organism")
baitsabovefifteen
#genome bases above 15
abovefifteen<- s %>% dplyr::select(organism.x, frac_genome_bases_over_15) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=as.numeric(frac_genome_bases_over_15), fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Proportion Genome Above 15X") +
xlab("Organism")
genomeabovefifteen
#genome bases above 15
baitsabovefifteen<- s %>% dplyr::select(organism.x, baits_covered_overfifteen) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=as.numeric(baits_covered_overfifteen), fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Proportion Baits Covered Above 15X") +
xlab("Organism")
baitsabovefifteen
#genome bases above 15
abovefifteen<- s %>% dplyr::select(organism.x, frac_genome_bases_over_15) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=as.numeric(frac_genome_bases_over_15), fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Proportion Genome Above 15X") +
xlab("Organism")
genomeabovefifteen
#genome bases above 15
genomeabovefifteen<- s %>% dplyr::select(organism.x, frac_genome_bases_over_15) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=as.numeric(frac_genome_bases_over_15), fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Proportion Genome Above 15X") +
xlab("Organism")
genomeabovefifteen
#genome bases above 15
genomeabovefifteen<- s %>% dplyr::select(organism.x, frac_genome_bases_over_15) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=as.numeric(frac_genome_bases_over_15/100), fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Proportion Genome Above 15X") +
xlab("Organism")
genomeabovefifteen
#genome bases above 15
genomeabovefifteen<- s %>% dplyr::select(organism.x, frac_genome_bases_over_15) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=frac_genome_bases_over_15/100, fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Proportion Genome Above 15X") +
xlab("Organism")
genomeabovefifteen
#genome bases above 15
genomeabovefifteen<- s %>% dplyr::select(organism.x, frac_genome_bases_over_15) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=(frac_genome_bases_over_15 / 100), fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Proportion Genome Above 15X") +
xlab("Organism")
genomeabovefifteen
#genome bases above 15
genomeabovefifteen<- s %>% dplyr::select(organism.x, frac_genome_bases_over_15) %>% drop_na() %>%
ggplot(aes(x = organism.x, y= frac_genome_bases_over_15, fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Proportion Genome Above 15X") +
xlab("Organism")
genomeabovefifteen
#duplicates
duplicates <- s %>% dplyr::select(organism.x, duplicates, total.x) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=duplicates/total.x, fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
ylim(0,0.3) +
theme(legend.position = "none") +
ylab("Proportion Duplicates") +
xlab("Organism")
genomeabovefifteen
#genome bases above 15
genomeabovefifteen<- s %>% dplyr::select(organism.x, frac_genome_bases_over_15) %>% drop_na() %>%
ggplot(aes(x = organism.x, y= as.numeric(frac_genome_bases_over_15), fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha=0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Proportion Genome Above 15X") +
xlab("Organism")
genomeabovefifteen
plot_grid(
duplicates, meandoc, abovefifteen, genomeabovefifteen,
labels = c("A", "B", "C", "D"), ncol = 2
)
plot_grid(
duplicates, meandoc, baitsabovefifteen, genomeabovefifteen,
labels = c("A", "B", "C", "D"), ncol = 2
)
#duplicates
d0 <- MASS::glm.nb(data=total_tbl, duplicates ~ max_ct)
d1 <- MASS::glm.nb(data=total_tbl, duplicates ~ organism*max_ct)
#duplicates
d0 <- MASS::glm.nb(data=s, duplicates ~ max_ct)
d1 <- MASS::glm.nb(data=s, duplicates ~ organism*max_ct)
summary(d1)
d1 <- MASS::glm.nb(data=s, duplicates ~ organism.x*max_ct)
summary(d1)
summary(d0)
s %>% mutate(amisuccessful %>% case_when(baits_covered_overfifteen > 0.8))
s %>% mutate(amisuccessful %>% case_when(baits_covered_overfifteen > 0.8 ~ 'yes',
baits_covered_overfifteen < 0.8 ~ 'no'))
s %>% mutate(amisuccessful= case_when(baits_covered_overfifteen > 0.8 ~ 'yes',
baits_covered_overfifteen < 0.8 ~ 'no'))
s = s %>% mutate(amisuccessful= case_when(baits_covered_overfifteen > 0.8 ~ 'yes',
baits_covered_overfifteen < 0.8 ~ 'no'))
s %>% group_by(organism, amisuccessful) %>% count()
s %>% group_by(organism.x, amisuccessful) %>% count()
#wo
write_csv(s, '~/Projects/bactocap/metadata/all_metadata.csv')
View(covtable)
View(mappingdata)
left_join(mappingdata, covtable)
################
#let's take a look at our metadata
left_join(mappingdata, covtable, by = c('sample_id' = 'sample_id'))
mappingdata  <- rbind(read.csv("~/Projects/bactocap/datasets/mycoplasma/results/myco_mapping.csv") %>% mutate(organism = 'mycoplasma'),
read.csv("~/Projects/bactocap/datasets/anthrax/results/anth_mapping.csv") %>% mutate(organism = 'anthrax'))
mappingdata$sample_id = gsub('(.*)_\\w+', '\\1', mappingdata$sample_id)
anth_metadata = read.csv('~/Projects/bactocap/metadata/anthrax-metadata.csv')
myco_metadata = read.csv('~/Projects/bactocap/metadata/myco-full-metadata.csv')
metadata = anth_metadata %>%
dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles) %>% bind_rows(myco_metadata %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct) %>% add_column(bc_amp_cycles = NA))
View(metadata)
View(mappingdata)
metadata %>% group_by(organism) %>% count)
metadata %>% group_by(organism) %>% count()
mappingdata %>% group_by(organims) %>% count()
mappingdata %>% group_by(organism) %>% count()
left_join(mappingdata, metadata)
s = left_join(mappingdata, metadata)
View(s)
s = left_join(mappingdata, metadata) %>% filter(organism == 'anthrax')
View(s)
View(anth_metadata)
View(metadata)
anth_metadata
myco_metadata
anth_metadata = read.csv('~/Projects/bactocap/metadata/anthrax-metadata.csv') %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles)
myco_metadata = read.csv('~/Projects/bactocap/metadata/myco-full-metadata.csv') %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct) %>% add_column(bc_amp_cycles = NA)
rbind(anth_metadata, myco_metadata)
metadata = rbind(anth_metadata, myco_metadata)
metadata = anth_metadata %>%
dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles) %>% bind_rows(myco_metadata %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct) %>% add_column(bc_amp_cycles = NA))
s = left_join(mappingdata, metadata) %>% filter(organism == 'anthrax')
View(s)
anth_metadata = read.csv('~/Projects/bactocap/metadata/anthrax-metadata.csv') #%>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles)
View(anth_metadata)
anth_metadata = read.csv('~/Projects/bactocap/metadata/anthrax-metadata.csv') %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles)
anth_metadata = read.csv('~/Projects/bactocap/metadata/anthrax-metadata.csv')Â´# %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles)
anth_metadata = read.csv('~/Projects/bactocap/metadata/anthrax-metadata.csv')# %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles)
anth_metadata
View(metadata)
View(anth_metadata)
anth_metadata = read.csv('~/Projects/bactocap/metadata/anthrax-metadata.csv') %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles)
myco_metadata = read.csv('~/Projects/bactocap/metadata/myco-full-metadata.csv') %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct) %>% add_column(bc_amp_cycles = NA)
metadata = rbind(anth_metadata, myco_metadata)
s = left_join(mappingdata, metadata) %>% filter(organism == 'anthrax')
View(s)
mappingdata  <- rbind(read.csv("~/Projects/bactocap/datasets/mycoplasma/results/myco_mapping.csv") %>% mutate(organism = 'mycoplasma'),
read.csv("~/Projects/bactocap/datasets/anthrax/results/anth_mapping.csv") %>% mutate(organism = 'anthrax'))
mappingdata$sample_id = gsub('(.*)_\\w+', '\\1', mappingdata$sample_id)
anth_metadata = read.csv('~/Projects/bactocap/metadata/anthrax-metadata.csv') %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles)
myco_metadata = read.csv('~/Projects/bactocap/metadata/myco-full-metadata.csv') %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct) %>% add_column(bc_amp_cycles = NA)
anth_metadata
metadata = rbind(anth_metadata, myco_metadata)
anth_metadata %>% dplyr::select(polyom_id) %>% unique() %>% count()
metadata = anth_metadata %>%
dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles) %>% bind_rows(myco_metadata %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct) %>% add_column(bc_amp_cycles = NA))
metadata %>% group_by(organism) %>% count()
mappingdata %>% group_by(organism) %>% count()
s = left_join(mappingdata, metadata) %>% filter(organism == 'anthrax')
mappingdata  <- rbind(read.csv("~/Projects/bactocap/datasets/mycoplasma/results/myco_mapping.csv") %>% mutate(organism = 'mycoplasma'),
read.csv("~/Projects/bactocap/datasets/anthrax/results/anth_mapping.csv") %>% mutate(organism = 'anthrax'))
mappingdata$sample_id = gsub('(.*)_\\w+', '\\1', mappingdata$sample_id)
anth_metadata = read.csv('~/Projects/bactocap/metadata/anthrax-metadata.csv') %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles)
myco_metadata = read.csv('~/Projects/bactocap/metadata/myco-full-metadata.csv') %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct) %>% add_column(bc_amp_cycles = NA)
anth_metadata
metadata = rbind(anth_metadata, myco_metadata)
anth_metadata %>% dplyr::select(polyom_id) %>% unique() %>% count()
metadata = anth_metadata %>%
dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles) %>% bind_rows(myco_metadata %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct) %>% add_column(bc_amp_cycles = NA))
metadata %>% group_by(organism) %>% count()
mappingdata %>% group_by(organism) %>% count()
s = left_join(mappingdata, metadata) %>% filter(organism == 'anthrax')
View(s)
mappingdata  <- rbind(read.csv("~/Projects/bactocap/datasets/mycoplasma/results/myco_mapping.csv") %>% mutate(organism = 'mycoplasma'),
read.csv("~/Projects/bactocap/datasets/anthrax/results/anth_mapping.csv") %>% mutate(organism = 'anthrax'))
mappingdata$sample_id = gsub('(.*)_\\w+', '\\1', mappingdata$sample_id)
anth_metadata = read.csv('~/Projects/bactocap/metadata/anthrax-metadata.csv') %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles)
myco_metadata = read.csv('~/Projects/bactocap/metadata/myco-full-metadata.csv') %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct) %>% add_column(bc_amp_cycles = NA)
anth_metadata
metadata = rbind(anth_metadata, myco_metadata)
anth_metadata %>% dplyr::select(polyom_id) %>% unique() %>% count()
metadata = anth_metadata %>%
dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles) %>% bind_rows(myco_metadata %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct) %>% add_column(bc_amp_cycles = NA))
metadata %>% group_by(organism) %>% count()
mappingdata %>% group_by(organism) %>% count()
s = left_join(mappingdata, metadata) %>% filter(organism == 'anthrax')
View(s)
mappingdata  <- rbind(read.csv("~/Projects/bactocap/datasets/mycoplasma/results/myco_mapping.csv") %>% mutate(organism = 'mycoplasma'),
read.csv("~/Projects/bactocap/datasets/anthrax/results/anth_mapping.csv") %>% mutate(organism = 'anthrax'))
mappingdata$sample_id = gsub('(.*)_\\w+', '\\1', mappingdata$sample_id)
anth_metadata = read.csv('~/Projects/bactocap/metadata/anthrax-metadata.csv') %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles)
myco_metadata = read.csv('~/Projects/bactocap/metadata/myco-full-metadata.csv') %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct) %>% add_column(bc_amp_cycles = NA)
anth_metadata
metadata = rbind(anth_metadata, myco_metadata)
anth_metadata %>% dplyr::select(polyom_id) %>% unique() %>% count()
metadata = anth_metadata %>%
dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles) %>% bind_rows(myco_metadata %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct) %>% add_column(bc_amp_cycles = NA))
metadata %>% group_by(organism) %>% count()
mappingdata %>% group_by(organism) %>% count()
s = left_join(mappingdata, metadata) %>% filter(organism == 'anthrax')
mappingdata  <- rbind(read.csv("~/Projects/bactocap/datasets/mycoplasma/results/myco_mapping.csv") %>% mutate(organism = 'mycoplasma'),
read.csv("~/Projects/bactocap/datasets/anthrax/results/anth_mapping.csv") %>% mutate(organism = 'anthrax'))
mappingdata$sample_id = gsub('(.*)_\\w+', '\\1', mappingdata$sample_id)
anth_metadata = read.csv('~/Projects/bactocap/metadata/anthrax-metadata.csv') %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles)
myco_metadata = read.csv('~/Projects/bactocap/metadata/myco-full-metadata.csv') %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct) %>% add_column(bc_amp_cycles = NA)
anth_metadata
metadata = rbind(anth_metadata, myco_metadata)
anth_metadata %>% dplyr::select(polyom_id) %>% unique() %>% count()
metadata = anth_metadata %>%
dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles) %>% bind_rows(myco_metadata %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct) %>% add_column(bc_amp_cycles = NA))
metadata %>% group_by(organism) %>% count()
mappingdata %>% group_by(organism) %>% count()
s = left_join(mappingdata, metadata) %>% filter(organism == 'anthrax')
mappingdata  <- rbind(read.csv("~/Projects/bactocap/datasets/mycoplasma/results/myco_mapping.csv") %>% mutate(organism = 'mycoplasma'),
read.csv("~/Projects/bactocap/datasets/anthrax/results/anth_mapping.csv") %>% mutate(organism = 'anthrax'))
mappingdata$sample_id = gsub('(.*)_\\w+', '\\1', mappingdata$sample_id)
anth_metadata = read.csv('~/Projects/bactocap/metadata/anthrax-metadata.csv') %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles)
myco_metadata = read.csv('~/Projects/bactocap/metadata/myco-full-metadata.csv') %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct) %>% add_column(bc_amp_cycles = NA)
anth_metadata
metadata = rbind(anth_metadata, myco_metadata)
anth_metadata %>% dplyr::select(polyom_id) %>% unique() %>% count()
metadata = anth_metadata %>%
dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct, bc_amp_cycles) %>% bind_rows(myco_metadata %>% dplyr::select(organism, sample_id, cap_lib_conc, init_lib_conc, max_ct) %>% add_column(bc_amp_cycles = NA))
metadata %>% group_by(organism) %>% count()
mappingdata %>% group_by(organism) %>% count()
s = left_join(mappingdata, metadata) %>% filter(organism == 'anthrax')
#join interval to total cov tables
covtable = interval_tbl %>%
dplyr::select(sample_id, baits_covered_overfifteen) %>%
left_join(sum_tbl %>%
dplyr::select(-organism, -filename)) %>%
rename(frac_genome_bases_over_15 = `%_bases_above_15`)
left_join(mappingdata, covtable)
################
#let's take a look at our metadata
left_join(mappingdata, covtable, by = c('sample_id' = 'sample_id'))
#check everything is ok (e.g. we have the req uired number of samples for anthrac (93) and myco (56))
total_tbl %>%  group_by(organism) %>% count()
#join to sample metadata
s = left_join(metadata, total_tbl, by =c('sample_id' = 'sample_id'))
s = s %>% mutate(amisuccessful= case_when(baits_covered_overfifteen > 0.8 ~ 'yes',
baits_covered_overfifteen < 0.8 ~ 'no'))
s %>% group_by(organism.x, amisuccessful) %>% count()
################
#let's take a look at our metadata
left_join(mappingdata, covtable, by = c('sample_id' = 'sample_id'))
#check everything is ok (e.g. we have the req uired number of samples for anthrac (93) and myco (56))
total_tbl %>%  group_by(organism) %>% count()
#join to sample metadata
s = left_join(metadata, total_tbl, by =c('sample_id' = 'sample_id'))
s = s %>% mutate(amisuccessful= case_when(baits_covered_overfifteen > 0.8 ~ 'yes',
baits_covered_overfifteen < 0.8 ~ 'no'))
s %>% group_by(organism.x, amisuccessful) %>% count()
#wo
write_csv(s, '~/Projects/bactocap/metadata/all_metadata.csv')
#pl mean_d_o_c
meandoc <- s %>% dplyr::select(organism.x, mean) %>% drop_na() %>%
ggplot(aes(x = organism.x, y=mean, fill=organism.x)) +
geom_boxplot(width = 0.5, alpha = 0.7) +
geom_jitter(width = 0.1, alpha = 0.5) +
scale_fill_manual(values=c("deepskyblue1", "darkorange")) +
theme_minimal() +
theme(legend.position = "none") +
ylab("Mean Depth-of-Coverage") +
xlab("Organism")
setwd('~/Projects/bactocap/datasets/mlst/')
mapstats <- read_delim('/Users/tristanpwdennis/Projects/bactocap/ancillary/metadata/idxstats_udref.txt', delim = '\t', col_names = FALSE)
colnames(mapstats) = c('sample_id', 'locus', 'length', 'mapped', 'unmapped')
mapstats$sample_id = sub("/[^/]+$", "", mapstats$sample_id)
mapstats$sample_id = sub("_[^_]+$", "", mapstats$sample_id)
#fix mapstats sample id
targstats <- read_delim('~/Projects/bactocap/datasets/mlst/metadata/target_stats.txt', delim = '\t')
metadata <- read_delim('~/Projects/bactocap/datasets/mlst/metadata/mlst_metadata.tsv', delim = '\t')
mlstmapping <- read_csv('~/Projects/bactocap/datasets/mlst/metadata/mapstatstable_mlst.csv')
library(tidyverse)
library(RColorBrewer)
library(ggridges)
library(cowplot)
library(pheatmap)
setwd('~/Projects/bactocap/datasets/mlst/')
mapstats <- read_delim('/Users/tristanpwdennis/Projects/bactocap/ancillary/metadata/idxstats_udref.txt', delim = '\t', col_names = FALSE)
colnames(mapstats) = c('sample_id', 'locus', 'length', 'mapped', 'unmapped')
mapstats$sample_id = sub("/[^/]+$", "", mapstats$sample_id)
mapstats$sample_id = sub("_[^_]+$", "", mapstats$sample_id)
#fix mapstats sample id
targstats <- read_delim('~/Projects/bactocap/datasets/mlst/metadata/target_stats.txt', delim = '\t')
metadata <- read_delim('~/Projects/bactocap/datasets/mlst/metadata/mlst_metadata.tsv', delim = '\t')
mlstmapping <- read_csv('~/Projects/bactocap/datasets/mlst/metadata/mapstatstable_mlst.csv')
source('~/Projects/bactocap/bin/mlst_fullset.R')
View(mapstats)
